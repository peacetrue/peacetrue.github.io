<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>压力测试 :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/Bee/test.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="Bee" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">开发者助手</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">简介</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="requirement/requirement.html">需求</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="requirement/function.html">功能</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="requirement/design.html">设计</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="architecture/architecture.html">架构</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture/frontend.html">前端项目</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="architecture/backend.html">后端项目</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">实现</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implement/api.html">接口文档</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="implement/manual.html">用户手册</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">性能</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="test.html">压力测试</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="version.html">版本</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">开发者助手</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue/index.html">基础组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-cryptography/index.html">密码学组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-cryptography/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">开发者助手</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../overview/index.html">概述</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../overview/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-template/index.html">目录模板引擎</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-template/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">开发者助手</a></li>
    <li>性能</li>
    <li><a href="test.html">压力测试</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/bee/edit/master/docs/antora/modules/ROOT/pages/test.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">压力测试</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本文将使用 JMeter 5.4.1 测试出网站的最佳负载情况。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_概述"><a class="anchor" href="#_概述"></a>1. 概述</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_注意事项"><a class="anchor" href="#_注意事项"></a>1.1. 注意事项</h3>
<div class="paragraph">
<p>请求必须设置连接超时和响应超时，
否则有些连接一直未完成，
导致整个测试计划不能退出。
连接超时一般设置为 500 毫秒；
响应超时一般设置为 3000 毫秒。</p>
</div>
<div class="paragraph">
<p>测试时间较短时，执行相同的测试，
可能得到不同的测试结果，且差距较大。</p>
</div>
</div>
<div class="sect2">
<h3 id="_测试方案"><a class="anchor" href="#_测试方案"></a>1.2. 测试方案</h3>
<div class="paragraph">
<p>先使用较短的时间，快速测试网站的最佳性能，
找出大概范围后，再加长时间测试出更为准确的值。</p>
</div>
<div class="paragraph">
<p>一般从 0 开始，每秒增加一个线程，增加到 1000，持续 1000 秒。
观察此过程中，什么时间点 TPS 达到最高。
找到时间点对应的线程数 <strong>n</strong>，
然后从 <strong>n-10</strong> 开始，1000 秒内，
增加到 <strong>n+10</strong>，持续 1000 秒。</p>
</div>
</div>
<div class="sect2">
<h3 id="_具体操作"><a class="anchor" href="#_具体操作"></a>1.3. 具体操作</h3>
<div class="paragraph">
<p>使用 GUI 模式设计测试计划，使用 NON_GUI 运行负载测试。
为了方便调整负载测试的属性，设计了一些变量：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-23-06-51-54-752.png" alt="image 2022 08 23 06 51 54 752">
</div>
</div>
<div class="paragraph">
<p>默认值都为 1，GUI 模式下，只需要运行 1 次，确认请求调用正常。
NON_GUI 模式下，通过配置文件 <strong>options.properties</strong> 设置属性值：</p>
</div>
<div class="listingblock">
<div class="title">options.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">Unresolved include directive in modules/ROOT/pages/test.adoc - include::example$backend/src/test/resources/jmxs/options-1000.properties[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行测试计划时，指定配置文件 <strong>options.properties：</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jmeter -n -t test-plan.jmx -q options.properties -l result.csv -e -o report</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_影响因数"><a class="anchor" href="#_影响因数"></a>1.4. 影响因数</h3>
<div class="ulist">
<ul>
<li>
<p>宽带：读取超时</p>
</li>
<li>
<p>连接数：连接超时，IO 模型</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_已知网站"><a class="anchor" href="#_已知网站"></a>2. 已知网站</h2>
<div class="sectionbody">
<div class="paragraph">
<p>测试一些已知网站，感受它们的负载情况。</p>
</div>
<div class="sect2">
<h3 id="_阿里云"><a class="anchor" href="#_阿里云"></a>2.1. 阿里云</h3>
<div class="paragraph">
<p>使用如下配置，探测网站的最佳性能：</p>
</div>
<div class="listingblock">
<div class="title">options.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">Unresolved include directive in modules/ROOT/pages/test.adoc - include::example$backend/src/test/resources/jmxs/options-1000.properties[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试结果如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-23-08-06-06-069.png" alt="image 2022 08 23 08 06 06 069">
</div>
</div>
<div class="paragraph">
<p>7:11 处 TPS 达到最大值 740，此时线程数为 (7:11-7:06) * 60=300。</p>
</div>
</div>
<div class="sect2">
<h3 id="_百度"><a class="anchor" href="#_百度"></a>2.2. 百度</h3>
<div class="paragraph">
<p>测试 <a href="https://www.baidu.com" class="bare">https://www.baidu.com</a> 。</p>
</div>
<div class="sect3">
<h4 id="_制定计划"><a class="anchor" href="#_制定计划"></a>2.2.1. 制定计划</h4>
<div class="paragraph">
<p>通过 UI 配置测试计划：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-10-18-45-690.png" alt="image 2022 08 22 10 18 45 690">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-10-16-16-711.png" alt="image 2022 08 22 10 16 16 711">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-10-18-19-314.png" alt="image 2022 08 22 10 18 19 314">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_执行"><a class="anchor" href="#_执行"></a>2.2.2. 执行</h4>
<div class="paragraph">
<p>配置属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">Unresolved include directive in modules/ROOT/pages/test.adoc - include::example$backend/src/test/resources/jmxs/baidu/options.properties[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>逐步增加线程数，花尽可能少的时间，得出比较全面准确的结果。</p>
</div>
<div class="paragraph">
<p>执行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jmeter -n -t test-plan.jmx -q options.properties -l result.csv -e -o report</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试报告：</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_服务器配置"><a class="anchor" href="#_服务器配置"></a>3. 服务器配置</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Ubuntu 22.04 64位</p>
</li>
<li>
<p>4 核 8 GiB</p>
</li>
<li>
<p>5 M 宽带</p>
</li>
<li>
<p>nginx/1.18.0</p>
</li>
<li>
<p>openjdk-17-jre-headless</p>
</li>
<li>
<p>mysql 8.0.30-0ubuntu0.22.04.1</p>
</li>
<li>
<p>peacetrue.cn 101.200.133.86</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jmeter_属性说明"><a class="anchor" href="#_jmeter_属性说明"></a>4. JMeter 属性说明</h2>
<div class="sectionbody">
<div class="paragraph">
<p>参考 <a href="https://jmeter.apache.org/usermanual/test_plan.html#thread_group" target="_blank" rel="noopener">thread_group</a> 。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">属性名</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">线程数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">threadCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">加速周期（秒）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rampUpSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">循环次数</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loopCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">整形，最大值 2147483647</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">持续时间（秒）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">durationSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">启动延迟（秒）</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">startupDelaySeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_nginx_性能"><a class="anchor" href="#_nginx_性能"></a>5. Nginx 性能</h2>
<div class="sectionbody">
<div class="paragraph">
<p>参考 <a href="https://github.com/denji/nginx-tuning">Nginx 性能调优</a> 。</p>
</div>
<div class="sect2">
<h3 id="_nginx_首页"><a class="anchor" href="#_nginx_首页"></a>5.1. Nginx 首页</h3>
<div class="paragraph">
<p>访问 <a href="http://peacetrue.cn/" class="bare">http://peacetrue.cn/</a> ，它是 Nginx 的首页，具有最佳性能。</p>
</div>
<div class="paragraph">
<p>使用 Nginx 默认配置，未做调整。</p>
</div>
<div class="paragraph">
<p>线程组配置：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-21-03-09-22-746.png" alt="image 2022 08 21 03 09 22 746">
</div>
</div>
<div class="listingblock">
<div class="title">属性</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">Unresolved include directive in modules/ROOT/pages/test.adoc - include::example$backend/src/test/resources/jmxs/nginx.properties[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jmeter -n -t nginx.jmx -q nginx.properties -l nginx.csv -e -o nginx</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试在达到持续时间后，仍未结束，观察日志（以下仅列出末尾的概要日志）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">summary +  17857 in 00:00:30 =  586.3/s Avg:   259 Min:    25 Max: 75061 Err:     0 (0.00%) Active: 28 Started: 180 Finished: 152
summary = 144361 in 00:03:28 =  694.8/s Avg:   130 Min:    25 Max: 75810 Err:     0 (0.00%)</code></pre>
</div>
</div>
<div class="paragraph">
<p>有线程一直未完成，导致整个测试不能结束。
可能发生了连接泄漏，设置超时时间：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-03-03-13-460.png" alt="image 2022 08 22 03 03 13 460">
</div>
</div>
<div class="paragraph">
<p>重新执行测试，测试报告如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-03-09-22-746.png" alt="image 2022 08 22 03 09 22 746">
</div>
</div>
<div class="paragraph">
<p>ECS 监控如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-03-32-46-418.png" alt="image 2022 08 22 03 32 46 418">
</div>
<div class="title">Figure 1. 公网带宽</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-03-33-05-316.png" alt="image 2022 08 22 03 33 05 316">
</div>
<div class="title">Figure 2. 同时连接数</div>
</div>
<div class="paragraph">
<p>减小响应数据后，重新执行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ cd /var/www/html
$ ls -l
-rw-r--r-- 1 root root 612 Aug 20 10:50 index.nginx-debian.html
echo 'Nginx custom index to reduce response' &gt; index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试报告如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-03-59-15-406.png" alt="image 2022 08 22 03 59 15 406">
</div>
</div>
<div class="paragraph">
<p>ECS 监控如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-01-55-798.png" alt="image 2022 08 22 04 01 55 798">
</div>
<div class="title">Figure 3. 公网带宽</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-02-12-250.png" alt="image 2022 08 22 04 02 12 250">
</div>
<div class="title">Figure 4. 同时连接数</div>
</div>
<div class="paragraph">
<p>升级宽带：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-10-02-702.png" alt="image 2022 08 22 04 10 02 702">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-18-31-922.png" alt="image 2022 08 22 04 18 31 922">
</div>
</div>
<div class="paragraph">
<p>再次执行测试：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-23-10-898.png" alt="image 2022 08 22 04 23 10 898">
</div>
</div>
<div class="paragraph">
<p>ECS 监控如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-24-02-911.png" alt="image 2022 08 22 04 24 02 911">
</div>
<div class="title">Figure 5. 公网带宽</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-25-03-121.png" alt="image 2022 08 22 04 25 03 121">
</div>
<div class="title">Figure 6. 同时连接数</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-26-48-173.png" alt="image 2022 08 22 04 26 48 173">
</div>
</div>
<div class="paragraph">
<p>调整 Nginx 配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	multi_accept on;
}

http {

	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;

	##
	# Gzip Settings
	##

	gzip on;

	# gzip_vary on;
	# gzip_proxied any;
	# gzip_comp_level 6;
	# gzip_buffers 16 8k;
	# gzip_http_version 1.1;
	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

	##
	# Virtual Host Configs
	##

	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试报告如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-04-47-35-480.png" alt="image 2022 08 22 04 47 35 480">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bee"><a class="anchor" href="#_bee"></a>6. Bee</h2>
<div class="sectionbody">
<div class="paragraph">
<p>使用健康检查接口，测试 Bee 的性能。</p>
</div>
<div class="paragraph">
<p>健康检查接口的地址如下：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tomcat：http://peacetrue.cn:8080/actuator/health</p>
</li>
<li>
<p>Nginx ：http://bee.peacetrue.cn/api/actuator/health</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_tomcat_9"><a class="anchor" href="#_tomcat_9"></a>6.1. Tomcat 9</h3>
<div class="paragraph">
<p>Bee 使用 Tomcat 9 作为 Web 服务器，
初始 Tomcat 使用默认的配置，后续根据测试结果调整。</p>
</div>
<div class="paragraph">
<p>使用如下 JMeter 配置属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">Unresolved include directive in modules/ROOT/pages/test.adoc - include::example$backend/src/test/resources/jmxs/options-300.properties[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行测试计划：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jmeter -n -t test-plan.jmx -q options.properties -l result.csv -e -o report</code></pre>
</div>
</div>
<div class="paragraph">
<p>得到测试结果：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-23-20-10-09-469.png" alt="image 2022 08 23 20 10 09 469">
</div>
</div>
<div class="paragraph">
<p>观察发现，错误率比较高，主要是
<code>ConnectTimeoutException</code> 和 <code>SocketTimeoutException</code>。</p>
</div>
<div class="paragraph">
<p>查看服务器日志，没有发现错误日志。
客户端发生错误，服务端却没有体现，是什么原因？</p>
</div>
<div class="paragraph">
<p><code>ConnectTimeoutException</code> 可能是达到了连接数上限。</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
