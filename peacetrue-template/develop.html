<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>开发指南 :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/peacetrue-template/develop.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="peacetrue-template" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">目录模板引擎</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">简介</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="start.html">入门</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="manual.html">用户手册</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="develop.html">开发指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">示例</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="samples/antora.html">Antora 目录模板</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="samples/antora-module.html">Antora 模块目录模板</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="case.html">场景</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="version.html">版本</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">目录模板引擎</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue/index.html">基础组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-cryptography/index.html">密码学组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-cryptography/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../overview/index.html">概述</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../overview/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">目录模板引擎</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">目录模板引擎</a></li>
    <li><a href="develop.html">开发指南</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/peacetrue-template/edit/master/docs/antora/modules/ROOT/pages/develop.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">开发指南</h1>
<div class="sect1">
<h2 id="_类库"><a class="anchor" href="#_类库"></a>1. 类库</h2>
<div class="sectionbody">
<div class="paragraph">
<p>组件中包含的类库如下：</p>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-gradle hljs" data-lang="gradle">// 目录模板引擎
implementation "com.github.peacetrue.template:peacetrue-template-engine:1.0.0"
// 使用 Velocity 实现的模板引擎
implementation "com.github.peacetrue.template:peacetrue-template-velocity:1.0.0"
// 支持 Spring Boot 自动装配
implementation "com.github.peacetrue.template:peacetrue-template-spring:1.0.0"
// 支持命令行调用
implementation "com.github.peacetrue.template:peacetrue-template-shell:1.0.0"</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.0.0 为最新版。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="DirectoryTemplateEngine"><a class="anchor" href="#DirectoryTemplateEngine"></a>2. 目录模板引擎</h2>
<div class="sectionbody">
<div class="paragraph">
<p>目录模板引擎（<code>DirectoryTemplateEngine</code>）用于渲染指定位置的目录模板，并在指定路径处生成结果。</p>
</div>
<div class="sect2">
<h3 id="DirectoryTemplateEngineParams"><a class="anchor" href="#DirectoryTemplateEngineParams"></a>2.1. 参数说明</h3>
<div class="paragraph">
<p>渲染接口包含 4 个参数：</p>
</div>
<table class="tableblock frame-all grid-all fit-content stretch">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">目录模板位置</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">使用 <a href="#ConditionalResourcesLoader">ConditionalResourcesLoader</a> 加载</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">选项</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#Options">选项</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">变量</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">键值对</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">结果路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">生成结果所在目录路径</p></td>
</tr>
</tbody>
</table>
<table id="Options" class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 1. 选项</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resourceActions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">资源操作</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ResourceActions">资源操作</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<table id="ResourceActions" class="tableblock frame-all grid-all fit-content stretch">
<caption class="title">Table 2. 资源操作</caption>
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">描述</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">忽略</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluateResourcePath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">渲染资源路径</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">evaluateResourceContent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">渲染资源内容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyResourceContent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">拷贝资源内容</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">字符串</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>上述属性值均为 Java 正则表达式，根据资源路径，采用局部匹配模式，筛选资源，执行不同的操作。</p>
</div>
<div class="paragraph">
<p>Java 正则表达式的匹配模式包括：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">全词匹配</dt>
<dd>
<p>规则匹配整个字符串，例如：</p>
<div class="ulist">
<ul>
<li>
<p><code>.*\.log</code> 匹配 <code>spring-shell.log</code></p>
</li>
<li>
<p><code>log$</code> 不匹配 <code>spring-shell.log</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">局部匹配</dt>
<dd>
<p>规则匹配部分字符串，例如：</p>
<div class="ulist">
<ul>
<li>
<p><code>.*\.log</code> 匹配 <code>spring-shell.log</code></p>
</li>
<li>
<p><code>log</code> 匹配 <code>spring-shell.log</code></p>
</li>
<li>
<p><code>^log$</code> 不匹配 <code>spring-shell.log</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_默认实现类"><a class="anchor" href="#_默认实现类"></a>2.2. 默认实现类</h3>
<div class="paragraph">
<p>目录模板引擎的默认实现类为 <code>DirectoryTemplateEngineImpl</code>，
执行逻辑如下：</p>
</div>
<div class="imageblock plantuml">
<div class="content">
<img src="http://www.plantuml.com/plantuml/png/pLJBJi905DttA-O7_05Y38axLyO_g3f1ajgICZLnQL98LHvD01C57_W8H2COerA4mi_qpemhVy6M0gaon92uS3PDEkUSUy-vCnDF4radnguYoGRHL6Dt4-iIjAwfrM4FRRIqWbYr1Mw5DklqV0Zz2YqLOeWwp_Io5DsHPc41cR-QzDt-g6R1jk3eYhikd3PZY1SwK3o9KZpdE8eLoIqlpPKRbg5wyOslQ5eAmU2U5TfmQp8x6-vAo5-oGiPAlDE6WGcvxaScZv89LTFn214iiI5H6Z1qMULkHCHA6YF8l7czawdGd79uJrOCcU0DdDOCVGklosHdofdV03WERvYYSKHhV1EQfSmJOkLBQjciLw8NjTzwySSXaWXdCILZTNlH85OrbM2L_44MaCr0g_j_iWWEXo20BIsrlxXvuRqyxl2NywXvi9v-M10TqSMgU4uU3ix2QpKpwCbNrGX6UZAnC_7YkKDMRg8rUKz6zF46h5DUR_B10Fh5ptvk3A9NNPflHJFozyAOmfyHw663rtD1BtQEdPcqbFVSsgI5KNafw2NocFbJ4jaPJodke_rty0i0" alt="DirectoryTemplateEngineFlow">
</div>
<div class="title">Figure 1. 目录模板引擎渲染时序图</div>
</div>
<div class="paragraph">
<p>渲染资源路径时，如果变量为路径，会生成多个目录。
例如：<a href="samples/antora-module.html#evaluateResourcePath" class="xref page">渲染资源路径</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_默认实例"><a class="anchor" href="#_默认实例"></a>2.3. 默认实例</h3>
<div class="paragraph">
<p>组件中默认使用的目录模板引擎实例为：<code>velocityDirectoryTemplateEngine</code>。
该实例会忽略默认的变量描述文件 <strong>VARIABLE.adoc</strong>；
渲染以 <strong>.vm</strong> 结尾的模板文件，例如：<strong>index.adoc.vm</strong> 渲染为 <strong>index.adoc</strong>；
拷贝其他文件。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_资源集合加载器"><a class="anchor" href="#_资源集合加载器"></a>3. 资源集合加载器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>资源集合加载器（<code>ResourcesLoader</code>）用于获取目录模板下指定资源。
资源（<code>Resource</code>）中包含路径和内容。</p>
</div>
<div class="paragraph">
<p>组件内置了 3 个实现：</p>
</div>
<div id="ConditionalResourcesLoader" class="dlist">
<dl>
<dt class="hdlist1"><code>ConditionalResourcesLoader</code></dt>
<dd>
<p>条件性资源集合加载器，根据位置前缀选择合适的资源集合加载器：</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>file:</code> : <code>FileSystemResourcesLoader</code></p>
</li>
<li>
<p><code>classpath:</code> : <code>ClasspathResourcesLoader</code></p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1"><code>FileSystemResourcesLoader</code></dt>
<dd>
<p>文件系统资源集合加载器，支持从文件系统加载目录或压缩包。
压缩包只支持 zip 包（路径以 .zip 结尾）或 jar 包（路径以 .jar 结尾）。
不支持其他格式，因为 Java 原生只提供了 zip 包和 jar 包的解析，
如果是其他格式的压缩包，请自行转换格式。</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ClasspathResourcesLoader</code></dt>
<dd>
<p>类路径资源集合加载器，支持从类路径加载资源。</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_模板引擎"><a class="anchor" href="#_模板引擎"></a>4. 模板引擎</h2>
<div class="sectionbody">
<div class="paragraph">
<p>模板引擎（<code>TemplateEngine</code>）是一个接口，用于避免直接依赖具体模板引擎。内置了 1 个实现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VelocityTemplateEngine</code>：基于 <a href="https://velocity.apache.org/" target="_blank" rel="noopener">Velocity</a> 实现的模板引擎</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>开发者也可自定义其他实现，例如：基于 <a href="https://freemarker.apache.org/" target="_blank" rel="noopener">FreeMark</a> 实现。</p>
</div>
<div class="sect2">
<h3 id="_velocitytemplateengine"><a class="anchor" href="#_velocitytemplateengine"></a>4.1. <code>VelocityTemplateEngine</code></h3>
<div class="paragraph">
<p><code>VelocityTemplateEngine</code> 默认启用了 <a href="https://velocity.apache.org/tools/3.1/index.html" target="_blank" rel="noopener">Velocity 工具</a> 支持。
同时，笔者还扩展了 Velocity 工具，也集成在了组件中，详情参考 <a href="https://oss.sonatype.org/service/local/repositories/releases/archive//com/github/peacetrue/peacetrue-velocity/1.0.0/peacetrue-velocity-1.0.0-javadoc.jar/!/index.html" target="_blank" rel="noopener">javadoc</a>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_命令行"><a class="anchor" href="#_命令行"></a>5. 命令行</h2>
<div class="sectionbody">
<div class="paragraph">
<p>为了方便使用目录模板引擎，提供了基于命令行的调用方式。
使用命令行，需要下载 <a href="_attachments/templates/template-engine.jar" target="_blank" rel="noopener">目录模板引擎类库</a>。
下载完成后，会得到一个 template-engine.jar。</p>
</div>
<div class="paragraph">
<p>命令行使用的参数与 <a href="#DirectoryTemplateEngineParams">目录模板引擎参数</a> 类似，
因为命令行无法直接传递对象参数（选项和变量），
所以对象参数改成了一个指向属性文件的位置，
读取属性文件内容，解析为对象。</p>
</div>
<div class="paragraph">
<p>渲染命令接口如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># 启动命令行
$ java -jar template-engine.jar

# 查看渲染命令
shell:&gt; help evaluate

NAME
        evaluate - 渲染目录模板

SYNOPSYS
        evaluate [[-t] string]  [[-v] string]  [[-o] string]  [[-r] string]

OPTIONS
        -t or --templateLocation  string
                目录模板位置。文件路径使用 file:/path/to/template，绝对路径以 / 起始，否则为相对路径，相对路径基于执行 java 命令时所在的目录；类路径使用 classpath:path/to/template，注意不要以 / 起始
                [Optional, default = file:template]

        -o or --optionsLocation  string
                选项属性文件位置。从 properties 文件中读取选项，文件路径规则同上
                [Optional, default = file:options.properties]

        -v or --variablesLocation  string
                变量属性文件位置。从 properties 文件中读取变量，文件路径规则同上。支持多个位置，使用逗号分割，例如：file:variables.properties,file:variables1.properties
                [Optional, default = file:variables.properties]

        -r or --resultPath  string
                结果路径。直接是文件路径，例如：/path/to/result，相对路径规则同上
                [Optional, default = result]</code></pre>
</div>
</div>
<div class="paragraph">
<p>具体调用示例可参考 <a href="manual.html#_命令行" class="xref page">用户手册</a>。</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
