<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用户手册 :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/peacetrue-template/manual.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="peacetrue-template" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">目录模板引擎</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">简介</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="start.html">入门</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="manual.html">用户手册</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="develop.html">开发指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">示例</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="samples/antora.html">Antora 目录模板</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="samples/antora-module.html">Antora 模块目录模板</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="case.html">场景</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="version.html">版本</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">目录模板引擎</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../overview/index.html">概述</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../overview/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">目录模板引擎</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-validation/index.html">验证扩展</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-validation/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">目录模板引擎</a></li>
    <li><a href="manual.html">用户手册</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/peacetrue-template/edit/master/docs/antora/modules/ROOT/pages/manual.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">用户手册</h1>
<div class="sect1">
<h2 id="_了解模板语法"><a class="anchor" href="#_了解模板语法"></a>1. 了解模板语法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>模板引擎不同，编写模板时使用的语法也不同。
目前组件内置的模板引擎基于 <a href="https://velocity.apache.org" target="_blank" rel="noopener">Velocity</a> 实现。
文档中涉及的示例，也均使用 Velocity 语法。
组件默认启用了 <a href="https://velocity.apache.org/tools/3.1/" target="_blank" rel="noopener">Velocity 工具</a> 支持，
开发者可以使用其中丰富地扩展支持。</p>
</div>
<div class="paragraph">
<p>模板语法之间虽然有所差异，但最终达成的效果是相同的，都包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>获取/设置变量值</p>
</li>
<li>
<p>判断</p>
</li>
<li>
<p>循环</p>
</li>
<li>
<p>调用方法</p>
</li>
<li>
<p>声明/调用宏</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_制作目录模板"><a class="anchor" href="#_制作目录模板"></a>2. 制作目录模板</h2>
<div class="sectionbody">
<div class="paragraph">
<p>常用的方式是基于已有代码制作目录模板。</p>
</div>
<div class="paragraph">
<p>开发某个功能时，意识到该功能和之前做过的某些功能，在代码上具有相似性。
此时可以考虑，基于之前的代码，制作目录模板。</p>
</div>
<div class="paragraph">
<p>浏览代码结构，确定哪些文件被忽略，哪些文件需要渲染，哪些文件直接拷贝。
需要渲染的模板文件后缀改为 <strong>vm</strong>，例如：<strong>README.adoc</strong> 改为 <strong>README.adoc.vm</strong>。
默认以 <strong>vm</strong> 结尾的文件会被渲染，其他文件直接拷贝。
如果默认规则不适用，可以通过选项属性文件更改。</p>
</div>
<div class="paragraph">
<p>使用 <a href="https://velocity.apache.org/engine/2.3/vtl-reference.html" target="_blank" rel="noopener">VTL</a> 语法，
修改模板文件的内容，同时整理出使用到的变量。
<strong>变量描述文件</strong> 约定为 <strong>VARIABLE.adoc</strong>，此文件默认被忽略，不会渲染到结果中。</p>
</div>
<div class="paragraph">
<p>在制作过程中，可以执行渲染，验证模板是否编写正确。
如确认无误，压缩目录和变量描述文件为 zip 包。
如果更改了选项，压缩时还应该包含 <strong>选项属性文件</strong>。
为了使用方便，还可以将 <strong>变量属性文件</strong> 也加入压缩包中。</p>
</div>
<div class="paragraph">
<p>以 <a href="samples/antora.html" class="xref page">Antora 目录模板</a> 为例说明：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># 查看已准备文件
$ ls -l
drwxr-xr-x   6 xiayx  staff       192 Aug 10 05:39 antora # 目录模板
-rw-r--r--   1 xiayx  staff       192 Aug 10 05:39 antora-variable.adoc # 变量描述文件
-rw-r--r--   1 xiayx  staff        78 Aug  9 20:55 antora-options.properties   # 选项属性文件
-rw-r--r--   1 xiayx  staff       170 Aug 10 17:32 antora-variables.properties # 变量属性文件

# 仅打包目录和变量描述文件
$ zip -rq antora.zip antora antora-variable.adoc
# 同时打包选项属性文件
$ zip -rq antora.zip antora antora-variable.adoc antora-options.properties
# 同时打包变量属性文件
$ zip -rq antora.zip antora antora-variable.adoc antora-options.properties antora-variables.properties

# 打 jar 包
$ jar -cf antora.zip antora antora-variable.adoc antora-options.properties antora-variables.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>目录模板的内容不受限制，可以实现各种各样的功能，满足了业务的复杂性。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_渲染目录模板"><a class="anchor" href="#_渲染目录模板"></a>3. 渲染目录模板</h2>
<div class="sectionbody">
<div class="paragraph">
<p>有 2 种实现渲染目录模板的方式：编程和命令行。
以下代码示例均基于 <strong>Antora 目录模板</strong>。</p>
</div>
<div class="sect2">
<h3 id="_编程"><a class="anchor" href="#_编程"></a>3.1. 编程</h3>
<div class="paragraph">
<p>如果是集成到 Java 项目中，可以使用该方式。</p>
</div>
<div class="paragraph">
<p>引用类库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-gradle hljs" data-lang="gradle">implementation "com.github.peacetrue.template:peacetrue-template-velocity:1.0.0"</code></pre>
</div>
</div>
<div class="paragraph">
<p>调用示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    /** Antora 目录模板 */
    @Test
    void antora() throws IOException {
        String templateLocation = LOCATION_PREFIX_FILE + ResourcesUtilsTest.templatesDirPath + "/antora";
        String resultPath = ResourcesUtilsTest.templatesDirPath + "/../results/learn";
        Path resultPathObject = Paths.get(resultPath);
        if (Files.exists(resultPathObject)) FileUtils.deleteRecursively(resultPathObject);
        DirectoryTemplateEngine templateEngine = VelocityTemplateEngine.buildVelocityDirectoryTemplateEngine();
        templateEngine.evaluate(
                templateLocation,
                getOptions(),
                Collections.singletonMap("repository", getRepository()),
                resultPath
        );
    }

    private Options getOptions() {
        return Options.builder()
                .resourceActions(
                        Options.ResourcePathPatterns.builder()
                                .ignore("antora-variable\\.adoc$")
                                .build()
                )
                .build();
    }

    private ImmutableMap&lt;String, String&gt; getRepository() {
        return ImmutableMap.of(
                "name", "Learn",
                "title", "学习",
                "description", "记录学习过程。",
                "directoryName", "learn",
                "packageName", "com.github.peacetrue.learn"
        );
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_命令行"><a class="anchor" href="#_命令行"></a>3.2. 命令行</h3>
<div class="paragraph">
<p>下载 <a href="_attachments/templates/template-engine.jar" target="_blank" rel="noopener">目录模板引擎类库</a>，
得到 template-engine.jar。</p>
</div>
<div class="paragraph">
<p>直接使用压缩包，基于类路径读取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ ls -l
-rw-r--r--  1 xiayx  staff     16751 Aug  8 13:05 antora.zip
-rw-r--r--  1 xiayx  staff  20143503 Aug 10 14:48 template-engine.jar

# 启动命令行
$ java -cp template-engine.jar:antora.zip org.springframework.boot.loader.JarLauncher

# 执行渲染命令
shell:&gt; evaluate -t classpath:quick-start/antora -o classpath:quick-start/antora-options.properties -v classpath:quick-start/antora-variables.properties -r learn

# 退出命令行
shell:&gt; quit</code></pre>
</div>
</div>
<div class="paragraph">
<p>解压压缩包，基于文件路径读取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># 解压
$ unzip antora.zip

$ ls -l
drwxr-xr-x  1 xiayx  staff       192 Aug  8 13:05 antora # 目录模板
-rw-r--r--  1 xiayx  staff       192 Aug 10 05:39 antora-antora-variable.adoc # 变量描述文件
-rw-r--r--  1 xiayx  staff        78 Aug  9 20:55 antora-options.properties   # 选项属性文件
-rw-r--r--  1 xiayx  staff       170 Aug 10 17:32 antora-variables.properties # 变量属性文件
-rw-r--r--  1 xiayx  staff     16751 Aug  8 13:05 antora.zip
-rw-r--r--  1 xiayx  staff  20143503 Aug 10 14:48 template-engine.jar

# 启动命令行
$ java -jar template-engine.jar

# 执行渲染命令
shell:&gt; evaluate -t file:antora -o file:antora-options.properties -v file:antora-variables.properties -r learn

# 退出命令行
shell:&gt; quit</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
