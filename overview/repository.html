<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>资源库 :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/overview/repository.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="overview" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">概述</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">简介</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="concept.html">理念</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="repository.html">资源库</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="term.html">术语</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="schedule.html">规划</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="author.html">作者</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">概述</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue/index.html">基础组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-cryptography/index.html">密码学组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-cryptography/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../bee/index.html">开发者助手</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../bee/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">概述</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-template/index.html">目录模板引擎</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-template/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">概述</a></li>
    <li><a href="repository.html">资源库</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/peacetrue.github.io/edit/master/docs/antora/modules/ROOT/pages/repository.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">资源库</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本文记录知识库中资源库的相关信息。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_内容规则"><a class="anchor" href="#_内容规则"></a>1. 内容规则</h2>
<div class="sectionbody">
<div class="paragraph">
<p>资源库在内容上具有一些相似的规则。</p>
</div>
<div class="sect2">
<h3 id="_文档管理"><a class="anchor" href="#_文档管理"></a>1.1. 文档管理</h3>
<div class="paragraph">
<p>资源库中的文档统一使用 <a href="https://antora.org" target="_blank" rel="noopener">Antora</a> 管理。</p>
</div>
</div>
<div class="sect2">
<h3 id="_自定义_antora_存储位置"><a class="anchor" href="#_自定义_antora_存储位置"></a>1.2. 自定义 Antora 存储位置</h3>
<div class="paragraph">
<p>Antora 文档默认存储在资源库的 <a href="https://docs.antora.org/antora/latest/standard-directories/" target="_blank" rel="noopener">根目录</a> 下，
这里调整到目录 <strong>docs/antora</strong> 下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">docs
└── antora
    ├── antora.yml
    └── modules
        └── ROOT
            ├── examples
            │   └── antora-structure.txt
            ├── nav.adoc
            └── pages
                ├── author.adoc
                ├── concept.adoc
                ├── convention
                │   └── repository.adoc
                ├── index.adoc -&gt; ../../../../../README.adoc
                └── schedule.adoc

6 directories, 9 files</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gitignore"><a class="anchor" href="#_gitignore"></a>1.3. .gitignore</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-.gitignore hljs" data-lang=".gitignore">Unresolved include directive in modules/ROOT/pages/repository.adoc - include::example$.gitignore[]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_github_workflows"><a class="anchor" href="#_github_workflows"></a>1.4. GitHub Workflows</h3>
<div class="paragraph">
<p>Java 项目使用 Gradle 构建：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yml hljs" data-lang="yml">name: build

on:
  push:
    branches: [ master ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    # 单元测试前置准备
    - name: Collect Workflow Telemetry
      uses: runforesight/foresight-workflow-kit-action@v1
      with:
        api_key: 6d66f622-6961-4fff-a0a4-3c46a0ba8aee

    - uses: actions/checkout@v3

    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'temurin'

    # 使用 Gradle 构建
    - name: Build with Gradle
      uses: gradle/gradle-build-action@0d13054264b0bb894ded474f08ebb30921341cee
      with:
        arguments: build

    # 单元测试
    - name: Analyze Test and/or Coverage Results
      uses: runforesight/foresight-test-kit-action@v1
      if: ${{ always() }}
      with:
        api_key: 6d66f622-6961-4fff-a0a4-3c46a0ba8aee
        test_format: JUNIT
        test_framework: JUNIT
        test_path: build/test-results/test
        coverage_format: JACOCO/XML
        coverage_path: build/reports/jacoco/test

    # 覆盖率测试
    - name: Codecov
      uses: codecov/codecov-action@v3.1.0
      if: success()</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有 Java 项目共享同一份构建脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash"># 所有项目放在同一目录下
$ ls -la
peacetrue.github.io
peacetrue-result

$ cd peacetrue-result

# 硬链接 java-gradle-build.yml
$ ln ../peacetrue.github.io/docs/antora/modules/ROOT/examples/java-gradle-build.yml .github/workflows/main.yml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_自述文件同步"><a class="anchor" href="#_自述文件同步"></a>1.5. 自述文件同步</h3>
<div class="paragraph">
<p>Antora 文档以 index.adoc 作为自述文件；
资源库以 README.adoc 作为自述文件。
两个自述文件在内容上具有相似性，
为了避免重复，让 2 个自述文件共享同一内容；
以 Antora 文档为主，将 README.adoc 软链接到 index.adoc：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ ln docs/antora/modules/ROOT/pages/index.adoc README.adoc
$ ln -s docs/antora/modules/ROOT/pages/index.adoc README.adoc
$ ln -s docs/antora/modules/ROOT/pages/index.adoc.vm README.adoc.vm</code></pre>
</div>
</div>
<div class="paragraph">
<p>index.adoc 中尽量避免使用与 Antora 相关的资源，
因为 README.adoc 无法直接读取那些资源。
为了保持两者展示效果的一致性，需要做一些额外处理。
比如：index.adoc 中引用了图片，需要将图片硬链接到根目录下，
这样 README.adoc 才能引用到：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ ln docs/antora/modules/ROOT/assets/images/antora-compare.png antora-compare.png</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者设置 index.adoc 的 <strong>imagesdir</strong> 属性：</p>
</div>
<div class="paragraph">
<p><code>:imagesdir: docs/antora/modules/ROOT/assets/images</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>1.6. examples</h3>
<div class="paragraph">
<p>写文档时会引用代码片段，代码需要放在 examples 目录下。
可以从源码目录下拷贝一份，但不能实现文件同步。
可以采用软链接的方式：</p>
</div>
<div class="listingblock">
<div class="title">链接 src 目录</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-gradle hljs" data-lang="gradle">$ cd docs/antora/modules/ROOT/examples
$ ln -s ../../../../src src</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_主题划分"><a class="anchor" href="#_主题划分"></a>2. 主题划分</h2>
<div class="sectionbody">
<div class="paragraph">
<p>根据内容涉及的主题划分资源库：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">learn</dt>
<dd>
<p>learn 记录学习过程。每个模块对应一块知识。</p>
</dd>
<dt class="hdlist1">samples</dt>
<dd>
<p>samples 存储代码样章。每个模块对应一个样章。</p>
</dd>
<dt class="hdlist1">peacetrue-convention</dt>
<dd>
<p>peacetrue-convention 存储二方库。</p>
</dd>
<dt class="hdlist1">peacetrue*</dt>
<dd>
<p>以 peacetrue 起头的资源库，存储三方库。</p>
</dd>
<dt class="hdlist1">peacetrue</dt>
<dd>
<p>peacetrue 存储简单的工具类库。</p>
</dd>
<dt class="hdlist1">peacetrue-result</dt>
<dd>
<p>peacetrue 存储响应结果组件。</p>
</dd>
<dt class="hdlist1">peacetrue-spring</dt>
<dd>
<p>peacetrue-spring 存储基于 <a href="https://spring.io" target="_blank" rel="noopener">Spring</a> 的扩展组件。</p>
</dd>
<dt class="hdlist1">peacetrue-module-*</dt>
<dd>
<p>以 peacetrue-module 起头的资源库，存储模块组件。</p>
</dd>
<dt class="hdlist1">peacetrue-bit</dt>
<dd>
<p>peacetrue-bit 存储基于 <a href="https://bit.dev" target="_blank" rel="noopener">bit</a> 实现的 JavaScript 组件。</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
以上未完待续！
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>资源库涉及的编程语言，包括：Java、JavaScript、Shell，以 Java 主。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_模块组织"><a class="anchor" href="#_模块组织"></a>3. 模块组织</h2>
<div class="sectionbody">
<div class="paragraph">
<p>根据资源库中模块的组织方式，可分为以下几类：</p>
</div>
<div id="singleModule" class="paragraph">
<div class="title">单模块</div>
<p>一个资源库中，仅包含一个模块，此模块即为根模块。</p>
</div>
<div id="depMultiModule" class="paragraph">
<div class="title">组合式多模块</div>
<p>一个资源库中，包含多个模块，模块之间相互关联，组成一个整体。
构建项目时，需要打包所有模块，模块越多构建速度越慢。</p>
</div>
<div id="indepMultiModule" class="paragraph">
<div class="title">独立式多模块</div>
<p>一个资源库中，包含多个模块，模块之间互不关联，自成一体。</p>
</div>
<div class="sect2">
<h3 id="_独立式多模块"><a class="anchor" href="#_独立式多模块"></a>3.1. 独立式多模块</h3>
<div class="paragraph">
<p>我们可以使用 <a href="#singleModule">单模块</a> 的方式，存储单个模块，
当模块内容比较丰富时，这么做是合适的；
当模块内容比较少时，就不合适了<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>。</p>
</div>
<div class="paragraph">
<p>此时，可以采用 <a href="#indepMultiModule">独立式多模块</a> 的方式，
比如：在样章资源库中存储独立的样章，每个样章作为一个模块。</p>
</div>
<div class="paragraph">
<p>在已经存在的资源库中新增模块，
比创建一个资源库存储模块，
显然要更方便，文档组织上也更加紧凑。</p>
</div>
<div class="paragraph">
<p>通常情况下，分支是基于版本划分的，
最新版本的分支包含着全部的内容。
如果只想查看某个模块的代码<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>，
在检出分支时，也包含了其他模块。
是否存在某种方式，检出的分支中，只包含指定的模块呢？
那就不能按版本划分分支，而需要按模块划分，称为 <strong>模块化分支</strong>。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_模块化分支"><a class="anchor" href="#_模块化分支"></a>4. 模块化分支</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>模块化分支</strong> 区别于主流的 <strong>版本化分支</strong>，
应用于 <a href="#indepMultiModule">独立式多模块</a> 资源库中。</p>
</div>
<div class="paragraph">
<p>以 learn 资源库为例，模块化分支实现思路如下：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>创建基础分支 antora，存储文档信息</p>
</li>
<li>
<p>基于基础分支，创建模块分支</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>创建 java 模块分支</p>
</li>
<li>
<p>创建 redis 模块分支</p>
</li>
<li>
<p>创建 mysql 模块分支</p>
</li>
</ol>
</div>
</li>
<li>
<p>基于基础分支，创建汇总分支 master，存储所有信息</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>合并 java 模块分支</p>
</li>
<li>
<p>合并 redis 模块分支</p>
</li>
<li>
<p>合并 mysql 模块分支</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>最终分支结构图如下：</p>
</div>
<div class="imageblock plantuml">
<div class="content">
<img src="http://www.plantuml.com/plantuml/png/SoWkIImgAStDuOfEp2l9BqgCLR3HrLM8paqiBaajYaKJpKeiIqGNAqfDoIn65yojB2xCGHVKqzEBvUA26AA0PWt453H1Y2beWY1JK8KSKlDIW3u00000" alt="module-branch">
</div>
<div class="title">Figure 1. 分支结构图</div>
</div>
<div class="paragraph">
<p>基于 Git 实现的示例命令如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">mkdir learn &amp;&amp; cd learn

git init
git branch -a
echo '' &gt; README.adoc
git add README.adoc
git commit -m 'init'
git branch -a

git checkout -b antora
echo '' &gt; index.adoc
git add index.adoc
git commit -m 'index.adoc'
git branch -a

git checkout -b java antora
echo '' &gt; java.adoc
git add java.adoc
git commit -m 'java'

git checkout -b redis antora
echo '' &gt; redis.adoc
git add redis.adoc
git commit -m 'redis'

git checkout -b mysql antora
echo '' &gt; mysql.adoc
git add mysql.adoc
git commit -m 'mysql'

git branch -a

git checkout master
git merge -m 'merge antora' antora
git merge -m 'merge java' java
git merge -m 'merge redis' redis
git merge -m 'merge mysql' mysql</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/image-2022-08-14-14-45-48-716.png" alt="image 2022 08 14 14 45 48 716">
</div>
</div>
<div class="paragraph">
<p>模块分支合并到聚合分支时，
容易产生冲突，需要想办法规避。
规避思路为，每个模块都使用各自独立的文件，
禁止两个模块共用同一个文件。</p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. 具体不合适的地方，会在后续与 <strong>独立式多模块</strong> 的对比中体现出来
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. 这种需求很常见，因为模块是独立的
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
