= 快递系统接口文档
黄金管家
v1.0, 2019-09-25: SNAPSHOT
:doctype: docbook
:toc: left
:numbered:
:_imagesdir: assets/images
:数据类型: <<_数据类型>>
:标准响应数据: <<标准响应数据,标准响应数据>>
:负载数据: <<负载数据,负载数据>>
:参数: <<_参数>>
:签名后参数: <<_签名后参数>>
:分页对象: <<分页对象,分页对象>>
:范围: <<范围,范围>>
:分页参数: <<_分页参数>>
:type: <<_类型>>
:整数: <<_整数>>
:小数: <<_小数>>
:字符串: <<_字符串>>
:布尔值: <<_布尔值>>
:日期: <<_日期>>
:任意类型: <<_任意类型>>
:数据结构格式: <<_数据结构格式>>

快递系统用于管理快递信息。

.快递流程
image::{_imagesdir}/express-flow.png[]

== 认证方式
客户端调用接口时，需要提供两个额外参数：应用标识和签名，
服务端会校验签名参数是否正确，
正确视为认证通过，否则视为认证失败。

签名过程中会涉及到应用标识和应用秘钥，
应用标识用于区分不同的客户端，
应用秘钥用于认证身份。

:leveloffset: +1

== 签名逻辑

=== 生成签名值
image::{_imagesdir}/generate-sign-value.png[]

=== 常规签名
image::{_imagesdir}/sign.png[]

=== JSON签名
image::{_imagesdir}/json-sign.png[]

== 请求方式
得到签名后参数，需要使用``raw``方式发送请求。

使用 postman 发送请求的示例：

image::{_imagesdir}/postman-raw.png[]

使用 Spring RestTemplate 发送请求的示例：
[source%nowrap,java]
----
HttpHeaders headers = new HttpHeaders();
headers.setContentType(MediaType.APPLICATION_JSON);
String params = "{\"data\":\"{\\\"c\\\":\\\"3\\\",\\\"b\\\":\\\"2\\\",\\\"a\\\":\\\"1\\\"}\",\"appId\":\"demo\",\"sign\":\"102A7048CAF22B9AA877B6D2FA7DCF58\"}";
HttpEntity<String> entity = new HttpEntity<>(params, headers);
this.restTemplate.postForObject("/requestBody", entity, String.class);
----


== 接口参数
在声明接口参数时，只需要声明原始参数，
不需要声明签名后参数，签名后参数的结构都是相同的：
[source%nowrap,json]
----
{
"data":"{原始参数}",
"appId":"{应用标识}",
"sign":"{签名值}"
}
----
签名后参数仅用于认证，认证通过后只需要使用原始参数。

:leveloffset: -1


== 数据类型
在描述接口时需要使用到数据类型，数据类型包括以下有效值：

:leveloffset: +1

== 基础类型
=== 整数
不带范围::
直接使用 _整数_
带范围::
整数(_min_,_max_)：min表示最小值、max表示最大值；
* 不确定最小值：整数(,_max_)
* 不确定最大值：整数(_min_)

=== 小数
不带范围::
直接使用 _小数_
带范围::
小数(_M_,_D_)：M 标度，表示小数总位数，D 精度，表示小数部分位数

=== 字符串
不带范围::
直接使用 _字符串_
带范围::
字符串(_size_)：size表示字符串的最大长度

=== 布尔值
布尔值作为参数时，默认接收以下有效值：

* true/false
* 1/0
* on/off

=== 日期
日期作为参数时，默认接收以下有效格式：

* yyyy-MM-dd
* yyyy-MM-dd HH:mm:ss
* 整形毫秒数

日期作为返回数据时，默认输出以下格式：

* yyyy-MM-dd HH:mm:ss

=== 集合
串联其他类型一起使用，例如：整数集合、字符串集合等等

== 自定义类型
使用 {数据结构格式} 声明的类型

== 任意类型
包含以上所有类型

== 类型的表述

* 可以使用一个具体的类型，例如：整数；
* 可以使用一个泛化类型，例如：基础类型、任意类型；
* 可以使用多个类型，例如：整数/字符串。

:leveloffset: -1

== 数据结构
:leveloffset: +1

== 数据结构格式
数据结构使用以下表格进行定义：

|===
|名称 |描述 |类型 |可空 |备注

|_属性名称_
|_属性描述_
|_{数据类型}_
|_是/否_
|_需要注意的事项_
|===


== 通用数据结构

[[标准响应数据]]
=== 标准响应数据<__待定类型__>
所有接口都返回此结构的数据

|===
|名称 |描述 |类型 |可空 |备注

|code
|编码
|整数/字符串
|否
|编码用于指示响应状态（是正常还是异常）

|message
|描述
|字符串
|否
|对应响应状态的具体描述信息

|[[负载数据]]data
|负载数据
|_待定类型_
|是
|具体类型根据实际情况决定
|===

=== 签名后参数
|===
|名称 |描述 |类型 |可空 |备注

|data
|原始参数
|字符串
|否
|

|appId
|应用标识
|字符串
|否
|

|sign
|签名值
|字符串
|否
|
|===

=== 参数
|===
|名称 |描述 |类型 |可空 |备注

|name
|参数名
|字符串
|否
|

|value
|参数值
|基本类型
|否
|

|type
|参数类型
|任意类型
|否
|具体类型根据实际情况而定
|===

[[分页对象]]
=== 分页对象<__待定类型__>
分页查询时返回的数据。

|===
|名称 |描述 |类型 |可空 |备注

|totalElements
|总数据条数
|整数
|否
|

|content
|数据
|_待定类型_ 集合
|否
|
|===

:leveloffset: -1


== 参数
:leveloffset: +1

== 参数格式
参数使用以下表格进行定义：

|===
|名称 |描述 |类型 |可空 |默认值 |备注

|_参数名称_
|_参数描述_
|_{数据类型}_
|_是/否_
|_此项参数无值时使用的默认值_
|_需要注意的事项_
|===
* 组合 {分页参数} ^<<_1,1>>^

.说明
. [[_1]]当前参数可以组合其他已存在的参数，表示继承关系
. 当前参数可以覆盖组合参数以修改变化的部分，例如：排序参数在分页参数中没有指定默认值，可以在当前参数中指定


== 通用参数

=== 分页参数
分页查询时输入的参数。

|===
|名称 |描述 |类型 |可空 |默认值 |备注

|page
|页码
|整数(0,)
|是
|0
|

|size
|每页记录条数
|整数(1,100)
|是
|10
|

|sort
|排序
|字符串集合
|是
|&nbsp;
|格式为：**__属性名__,asc/desc**，例如按姓名升序和创建时间倒序排列：sort=name,asc&sort=createdTime,desc
|===

[[范围]]
=== 范围<__待定类型__>
|===
|名称 |描述 |类型 |可空 |默认值 |备注

|lowerBound
|最小值
|_待定类型_
|是
|
|

|upperBound
|最大值
|_待定类型_
|是
|
|
|===

:leveloffset: -1


== 响应状态
:leveloffset: +1

== 响应状态格式
响应状态使用以下表格进行定义：

|===
|编码 |描述 |数据类型 |可空 |备注
|_状态编码_
|_状态描述_
|_{负载数据}的{数据类型}_
|{负载数据}是否可空：_是/否_
|_需要注意的事项_
|===

每一条响应状态都对应{标准响应数据}的一个实例，
以上表格列出不同响应状态返回的{负载数据}类型。

== 通用响应状态
|===
|编码 |描述 |数据类型 |可空 |备注
|success
|操作成功
|根据实际情况决定
|根据实际情况决定
|通用的成功状态

|sign_error
|签名错误
|{签名后参数}
|否
|

|parameter_missing
|缺失必须的参数'\{name}'
|{参数}
|否
|

|parameter_format_error
|参数'\{name}'的值'\{value}'的格式错误
|{参数}
|否
|

|parameter_range_error
|参数'\{name}'的值'\{value}'的范围错误
|{参数}
|否
|

|record_absent
|参数'\{name}'指定的记录'\{value}'不存在
|{参数}
|否
|

|record_exist
|参数'\{name}'指定的记录'\{value}'已存在
|{参数}
|否
|

|record_unowned
|参数'\{name}'指定的记录'\{value}'不被拥有
|{参数}
|否
|

|failure
|操作失败
|字符串
|是
|通用的异常状态，出现此状态需联系开发人员解决
|===

占位符对应的具体值会从负载数据中取得。

:leveloffset: -1

== 接口定义

=== 创建快递订单
创建快递订单

==== 地址
POST /order/add

==== 参数
|===
|名称 |描述 |类型 |可空 |默认值 |备注
|appId
|应用标识
|{字符串}(255)
|否
|
|

|senderName
|寄件人姓名
|{字符串}(255)
|否
|
|

|senderCompany
|寄件人公司
|{字符串}(255)
|否
|
|

|senderMobile
|寄件人手机号
|{字符串}(255)
|否
|
|

|senderAddress
|寄件人地址
|{字符串}(255)
|否
|
|

|sendTime
|上门取件时间
|{日期}
|是
|当前时间+1小时
|

|insure
|保价金额
|{小数}(10,2)
|是
|0
|
|===

==== 返回结果
|===
|编码 |描述 |数据类型 |可空 |备注
|success
|成功
|{字符串}
|否
|快递单号

|failure
|您的预约超出今日营业时间，无法上门收件
|
|是
|
|===


=== 分页查询快递订单
分页查询快递订单，默认按创建时间倒序排列。

==== 请求地址
GET /order/query

==== 参数
|===
|名称 |描述 |类型 |可空 |默认值 |备注

|expressCode
|快递单号
|{字符串}
|是
|&nbsp;
|模糊匹配

|createdTime
|创建时间范围
|{范围}<{日期}>
|是
|&nbsp;
|创建时间在指定范围内

|sort
|排序
|{字符串}集合
|是
|createdTime desc
|可排序属性包括：createdTime、modifiedTime
|===
* 组合 {分页参数}

==== 返回结果
|===
|编码 |描述 |数据类型 |可空 |备注
|success
|操作成功
|{分页对象}<<<快递订单>>>
|否
|
|===

[[快递订单]]
.快递订单
|===
|名称 |描述 |类型 |可空 |备注
|appId
|应用标识
|{字符串}(255)
|否
|

|senderName
|寄件人姓名
|{字符串}(255)
|否
|

|senderCompany
|寄件人公司
|{字符串}(255)
|否
|

|senderMobile
|寄件人手机号
|{字符串}(255)
|否
|

|senderAddress
|寄件人地址
|{字符串}(255)
|否
|

|sendTime
|上门取件时间
|{日期}
|否
|

|insure
|保价金额
|{小数}(10,2)
|否
|

|courierCode
|收派员工号
|{字符串}(31)
|是
|派件成功后有值

|courierMobile
|收派员手机号
|{字符串}(31)
|是
|派件成功后有值

|carriageFee
|物流费
|{小数}(8,2)
|是
|物流中有值

|insuranceFee
|保价费
|{小数}(8,2)
|是
|物流中有值

|nodeCode
|流程节点编码
|{字符串}(31)
|否
|参考<<快递订单节点编码>>

|stateCode
|节点状态编码
|{字符串}(15)
|否
|参考<<时态>>

|finishCode
|最终状态编码
|{字符串}(31)
|否
|参考<<终态>>
|===

[[快递订单节点编码]]
.快递订单节点编码
|===
|编码 |描述

|add
|新增

|dispatch
|派件

|deliver
|取件

|transit
|物流

|send
|派送

|cancel
|取消
|===

[[时态]]
.时态
|===
|编码 |描述

|todo
|待执行

|doing
|进行中

|success
|已完成

|failure
|已失败
|===


[[终态]]
.终态
|===
|编码 |描述

|doing
|进行中

|success
|已完成

|failure
|已关闭
|===


=== 获取快递订单详情
获取快递订单详情。

==== 地址
POST /order/get

==== 参数
|===
|名称 |描述 |类型 |可空 |默认值 |备注
|expressCode
|快递单号
|{字符串}(255)
|否
|
|
|===

==== 返回结果
|===
|编码 |描述 |数据类型 |可空 |备注
|success
|成功
|<<快递订单>>
|否
|
|===

