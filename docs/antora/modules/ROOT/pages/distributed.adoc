= 分布式系统

微服务拆分原则。

== 单点的问题

. 性能问题，连接的客户端多了，并发请求压力大，影响性能
. 容量问题，存储的数据量有限
. 可用性问题，进程挂了，服务不可用
. 数据丢失问题。进程挂了，内存数据同步到磁盘可能存在问题；服务器挂了，磁盘数据丢失

各种选择的权衡。

== AKF

AKF 拆分解决容量问题。

. 全量数据，比如 用户、订单
. 按业务拆分，比如 用户一个集群、订单一个集群
. 按范围拆分，比如 用户 0 ~ 1000 一个集群，用户 1000 ~ 2000 一个集群

== 主备模型

主节点向外提供服务，备节点提供数据备份，解决数据丢失问题。

客户端向主节点写入数据时，主节点向备节点写入数据。

如果必须等主节点写完所有备节点后，响应客户端请求，则称为强一致性，
如果备节点无法连通则影响可用性。

如果主节点异步写入备节点，立刻响应客户端，
若此时主节点故障，备节点未收到数据，则导致丢失数据。

为了解决数据丢失问题，实际又引入了新问题，未能解决问题。

== 主从模型

主节点向外提供读写服务，从节点向外提供读取服务，解决性能问题。

== 高可用

哨兵集群监控主节点是否挂了，如果挂了切换备节点为主节点。

哨兵集群自己挂了，怎么办。
