<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>快速入门 :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/peacetrue-common/start.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="peacetrue-common" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">公共组件</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">概述</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="start.html">快速入门</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="manual.html">用户手册</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="reference.html">参考指南</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="version.html">版本变更</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">公共组件</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">公共组件</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../learn-asciidoc/index.html">学习 AsciiDoc</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../learn-asciidoc/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-cryptography/index.html">密码学组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-cryptography/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../bee/index.html">开发者助手</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../bee/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../overview/index.html">总览</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../overview/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-test/index.html">测试组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-test/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-beans/index.html">简单 Java 对象</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-beans/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">公共组件</a></li>
    <li><a href="start.html">快速入门</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/peacetrue-common/edit/master/docs/antora/modules/ROOT/pages/start.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">快速入门</h1>
<div class="sect1">
<h2 id="_查看_非标准_bean"><a class="anchor" href="#_查看_非标准_bean"></a>1. 查看 <a href="reference.html#bean_structure" class="xref page">非标准 Bean</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>以下示例演示如何遍历非标准 Bean <code>PosixFileAttributeView</code>。</p>
</div>
<div class="sect2">
<h3 id="_jackson"><a class="anchor" href="#_jackson"></a>1.1. Jackson</h3>
<div class="paragraph">
<p>使用 Jackson 序列化：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    /** 使用 jackson 序列化 {@link PosixFileAttributeView} */
    @Test
    @SneakyThrows
    void jackson() {
        new JavaPropsMapper().writeValue(
                Files.newOutputStream(HelpAntora.POSIX_FILE_ATTRIBUTE_VIEW_DIR.resolve("jackson.properties")),
                BeanCommon.POSIX_FILE_ATTRIBUTE_VIEW
        );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出 properties 格式数据：</p>
</div>
<div class="listingblock">
<div class="title">jackson.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">owner.name=xiayx</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stringbeanvisitor"><a class="anchor" href="#_stringbeanvisitor"></a>1.2. StringBeanVisitor</h3>
<div class="paragraph">
<p>使用默认的 <code>StringBeanVisitor</code> 序列化：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    /** 使用默认的 {@link StringBeanVisitor} 序列化 {@link PosixFileAttributeView} */
    @Test
    @SneakyThrows
    void beanVisitorDefault() {
        String root = StringBeanVisitor.DEFAULT
                .visitRoot(BeanCommon.POSIX_FILE_ATTRIBUTE_VIEW);
        Files.write(
                HelpAntora.POSIX_FILE_ATTRIBUTE_VIEW_DIR.resolve("visitor.properties"),
                root.getBytes(StandardCharsets.UTF_8)
        );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出 properties 格式数据：</p>
</div>
<div class="listingblock">
<div class="title">visitor.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">owner.name=xiayx</code></pre>
</div>
</div>
<div class="paragraph">
<p>和 Jackson 输出的内容相同，因为默认情况下，都是支持标准 Bean。</p>
</div>
</div>
<div class="sect2">
<h3 id="_自定义_bean_遍历器"><a class="anchor" href="#_自定义_bean_遍历器"></a>1.3. 自定义 Bean 遍历器</h3>
<div class="paragraph">
<p>设置 Bean 遍历器为 <code>CustomReadonlyBeanTraverser</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    /** 使用自定义的 {@link BeanTraverser} 序列化 {@link PosixFileAttributeView} */
    @Test
    @SneakyThrows
    void beanVisitorCustomTraverser() {
        String root = StringBeanVisitor.builder()
                // 设置 Bean 遍历器，获取无参有返回值的方法
                .beanTraverser(CustomReadonlyBeanTraverser.DEFAULT)
                .build()
                .visitRoot(BeanCommon.POSIX_FILE_ATTRIBUTE_VIEW);
        Files.write(
                HelpAntora.POSIX_FILE_ATTRIBUTE_VIEW_DIR.resolve("visitor-custom-traverser.properties"),
                root.getBytes(StandardCharsets.UTF_8)
        );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出 properties 格式数据：</p>
</div>
<div class="listingblock">
<div class="title">visitor-custom-traverser.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">owner.name=xiayx
owner.hashCode=501
owner.toString=xiayx
name=posix
readAttributes.symbolicLink=false
readAttributes.permissions[0]=OWNER_EXECUTE
readAttributes.permissions[1]=OTHERS_EXECUTE
readAttributes.permissions[2]=GROUP_READ
readAttributes.permissions[3]=OTHERS_READ
readAttributes.permissions[4]=OWNER_WRITE
readAttributes.permissions[5]=GROUP_EXECUTE
readAttributes.permissions[6]=OWNER_READ
readAttributes.group.name=staff
readAttributes.group.hashCode=20
readAttributes.group.toString=staff
readAttributes.size=5766
readAttributes.other=false
readAttributes.directory=false
readAttributes.lastModifiedTime.toMillis=1651448508000
readAttributes.lastModifiedTime.hashCode=1651448508
readAttributes.lastModifiedTime.toInstant=2022-05-01T23:41:48Z
readAttributes.lastModifiedTime.toString=2022-05-01T23:41:48Z
readAttributes.creationTime.toMillis=1651448508000
readAttributes.creationTime.hashCode=1651448508
readAttributes.creationTime.toInstant=2022-05-01T23:41:48Z
readAttributes.creationTime.toString=2022-05-01T23:41:48Z
readAttributes.fileKey=(dev=1000005,ino=36821797)
readAttributes.owner.name=xiayx
readAttributes.owner.hashCode=501
readAttributes.owner.toString=xiayx
readAttributes.lastAccessTime.toMillis=1666797095000
readAttributes.lastAccessTime.hashCode=1666797095
readAttributes.lastAccessTime.toInstant=2022-10-26T15:11:35Z
readAttributes.lastAccessTime.toString=2022-10-26T15:11:35Z
readAttributes.regularFile=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_自定义所有"><a class="anchor" href="#_自定义所有"></a>1.4. 自定义所有</h3>
<div class="paragraph">
<p>上面的结果看着有些不清晰的地方，通过完全自定义解决这些问题：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java hljs" data-lang="java">    /** 使用自定义的 {@link BeanVisitor} 序列化 {@link PosixFileAttributeView} */
    @Test
    @SneakyThrows
    void beanVisitorCustomAll() {
        String root = StringBeanVisitor.builder()
                // FileTime 和 fileKey 作为叶子节点，toString 方法看着就很舒服
                .isLeafType(CoreBeanVisitor.in(FileTime.class)
                        .or(CoreBeanVisitor::isSimpleValueType)
                        .or((path, clazz) -&gt; path != null &amp;&amp; path.endsWith("fileKey"))
                )
                // 不知道 fileKey 是什么类型，使用带类型的属性路径
                .propertyPathBuilder(TypedPropertyPathBuilder.DEFAULT)
                // 设置 Bean 遍历器，获取无参有返回值的方法，然后根据方法名排除指定方法
                .beanTraverser(new CustomReadonlyBeanTraverser(exclude("hashCode", "toString")))
                .build()
                .visitRoot(BeanCommon.POSIX_FILE_ATTRIBUTE_VIEW);
        log.info("root:\n{}", root);
        Files.write(
                HelpAntora.POSIX_FILE_ATTRIBUTE_VIEW_DIR.resolve("visitor-custom-all.properties"),
                root.getBytes(StandardCharsets.UTF_8)
        );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出 properties 格式数据：</p>
</div>
<div class="listingblock">
<div class="title">visitor-custom-traverser.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties">owner(User).name(String)=xiayx
name(String)=posix
readAttributes(UnixFileAttributes).symbolicLink(Boolean)=false
readAttributes(UnixFileAttributes).permissions(HashSet)[0](PosixFilePermission)=OWNER_EXECUTE
readAttributes(UnixFileAttributes).permissions(HashSet)[1](PosixFilePermission)=OTHERS_EXECUTE
readAttributes(UnixFileAttributes).permissions(HashSet)[2](PosixFilePermission)=GROUP_READ
readAttributes(UnixFileAttributes).permissions(HashSet)[3](PosixFilePermission)=OTHERS_READ
readAttributes(UnixFileAttributes).permissions(HashSet)[4](PosixFilePermission)=OWNER_WRITE
readAttributes(UnixFileAttributes).permissions(HashSet)[5](PosixFilePermission)=GROUP_EXECUTE
readAttributes(UnixFileAttributes).permissions(HashSet)[6](PosixFilePermission)=OWNER_READ
readAttributes(UnixFileAttributes).group(Group).name(String)=staff
readAttributes(UnixFileAttributes).size(Long)=5766
readAttributes(UnixFileAttributes).other(Boolean)=false
readAttributes(UnixFileAttributes).directory(Boolean)=false
readAttributes(UnixFileAttributes).lastModifiedTime(FileTime)=2022-05-01T23:41:48Z
readAttributes(UnixFileAttributes).creationTime(FileTime)=2022-05-01T23:41:48Z
readAttributes(UnixFileAttributes).fileKey(UnixFileKey)=(dev=1000005,ino=36821797)
readAttributes(UnixFileAttributes).owner(User).name(String)=xiayx
readAttributes(UnixFileAttributes).lastAccessTime(FileTime)=2022-10-26T15:11:35Z
readAttributes(UnixFileAttributes).regularFile(Boolean)=true</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
