<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/bee/temp.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="bee" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">开发者助手</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">简介</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer.html">开发手册</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="version.html">版本变更</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">基础框架</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/framework/architecture.html">架构</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/framework/frontend.html">前端项目</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/framework/backend.html">后端项目</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/framework/load.html">负载测试</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">数据转换</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/conversion/requirement.html">需求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/conversion/function.html">功能</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/conversion/design.html">设计</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="iteration/conversion/api.html">接口</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">开发者助手</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-common/index.html">公共组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-common/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-cryptography/index.html">密码学组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-cryptography/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">开发者助手</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../overview/index.html">概述</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../overview/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-test/index.html">测试组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-test/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../peacetrue-beans/index.html">简单 Java 对象</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../peacetrue-beans/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/bee/edit/master/docs/antora/modules/ROOT/pages/temp.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_开发环境"><a class="anchor" href="#_开发环境"></a>1. 开发环境</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IntelliJ IDEA 2021.1.3</p>
</li>
<li>
<p>Gradle 7.4.2</p>
</li>
<li>
<p>JDK 17（源码级别 8、编译级别 8）</p>
</li>
<li>
<p>MySQL 5.7</p>
</li>
<li>
<p>Nginx 1.19.10</p>
</li>
<li>
<p>127.0.0.1 bee.peacetrue.cn</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_服务器环境"><a class="anchor" href="#_服务器环境"></a>2. 服务器环境</h2>
<div class="sectionbody">
<div class="paragraph">
<p>阿里云 ECS：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aliyun-server.png" alt="aliyun server">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ubuntu 22.04 64位</p>
</li>
<li>
<p>4 核 8 GiB</p>
</li>
<li>
<p>5 M 宽带</p>
</li>
<li>
<p>openjdk-17-jre-headless</p>
</li>
<li>
<p>nginx/1.18.0</p>
</li>
<li>
<p>mysql 8.0.30-0ubuntu0.22.04.1</p>
</li>
<li>
<p>101.200.133.86 bee.peacetrue.cn</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_免密登录"><a class="anchor" href="#_免密登录"></a>2.1. 免密登录</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">$ echo '101.200.133.86 aliyun' &gt;&gt; /etc/hosts
$ ssh-copy-id -i ~/.ssh/id_rsa.pub root@aliyun</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_预装命令"><a class="anchor" href="#_预装命令"></a>2.2. 预装命令</h3>
<div class="paragraph">
<p>参考 <a href="https://github.com/peacetrue/peacetrue-shell" class="bare">https://github.com/peacetrue/peacetrue-shell</a> 。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_跨域问题"><a class="anchor" href="#_跨域问题"></a>3. 跨域问题</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本地开发时， 前端运行在 <strong><a href="http://localhost:3000/" class="bare">http://localhost:3000/</a></strong>， 后端运行在 <strong><a href="http://localhost:8081/" class="bare">http://localhost:8081/</a></strong>。 从前端调用后台时，会导致跨域，如何解决呢？ 一般有 2 种途径：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>后端代码允许跨域</p>
</li>
<li>
<p>通过 Nginx 反向代理到相同域名下</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这里使用途径 2，保持与生产环境一致。</p>
</div>
<div class="paragraph">
<p>本地测试时使用域名 <strong>bee.peacetrue.local</strong>。</p>
</div>
<div class="paragraph">
<p>添加 hosts 条目：</p>
</div>
<div class="listingblock">
<div class="title">/etc/hosts</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">echo '127.0.0.1 bee.peacetrue.local' &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>准备 Nginx 配置：</p>
</div>
<div class="listingblock">
<div class="title">bee.peacetrue.local</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">server {
    listen       80;
    server_name  bee.peacetrue.local;

    root html/bee;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /monitor/ {
       proxy_pass http://localhost:8080/;
    }

    location /api/ {
       proxy_pass http://localhost:8081/;
    }

    location /swagger-ui/ {
       proxy_pass http://localhost:8081;
    }

    location /v3/api-docs/ {
       proxy_pass http://localhost:8081;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>链接到 Nginx 配置目录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">cd "$nginxDir/servers"
ln -s "$workingDir/bee/docs/antora/modules/ROOT/examples/nginx/bee.peacetrue.local.conf"  bee.peacetrue.local.conf
nginx -s reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>访问 <a href="http://bee.peacetrue.local" class="bare">http://bee.peacetrue.local</a> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_已知网站"><a class="anchor" href="#_已知网站"></a>4. 已知网站</h2>
<div class="sectionbody">
<div class="paragraph">
<p>测试一些已知网站，感受它们的负载情况。</p>
</div>
<div class="sect2">
<h3 id="_阿里云"><a class="anchor" href="#_阿里云"></a>4.1. 阿里云</h3>
<div class="paragraph">
<p>使用如下配置，探测网站的最佳性能：</p>
</div>
<div class="listingblock">
<div class="title">options.properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties"># 1000 秒内启动 1000 个线程，每秒增加 1 个线程，持续 1100 秒
threadCount=800
rampUpSeconds=10
loopCount=2147483647
durationSeconds=600
startupDelaySeconds=1
connectTimeout=500
responseTimeout=3000</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试结果如下：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-23-08-06-06-069.png" alt="image 2022 08 23 08 06 06 069">
</div>
</div>
<div class="paragraph">
<p>7:11 处 TPS 达到最大值 740，此时线程数为 (7:11-7:06) * 60=300。</p>
</div>
</div>
<div class="sect2">
<h3 id="_百度"><a class="anchor" href="#_百度"></a>4.2. 百度</h3>
<div class="paragraph">
<p>测试 <a href="https://www.baidu.com" class="bare">https://www.baidu.com</a> 。</p>
</div>
<div class="sect3">
<h4 id="_制定计划"><a class="anchor" href="#_制定计划"></a>4.2.1. 制定计划</h4>
<div class="paragraph">
<p>通过 UI 配置测试计划：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-10-18-45-690.png" alt="image 2022 08 22 10 18 45 690">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-10-16-16-711.png" alt="image 2022 08 22 10 16 16 711">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/test/image-2022-08-22-10-18-19-314.png" alt="image 2022 08 22 10 18 19 314">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_执行"><a class="anchor" href="#_执行"></a>4.2.2. 执行</h4>
<div class="paragraph">
<p>配置属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-properties hljs" data-lang="properties"># 300 秒内启动 300 个线程，每秒增加 1 个线程，持续 400 秒
threadCount=300
rampUpSeconds=300
loopCount=2147483647
durationSeconds=400
startupDelaySeconds=1
connectTimeout=1000
responseTimeout=3000</code></pre>
</div>
</div>
<div class="paragraph">
<p>逐步增加线程数，花尽可能少的时间，得出比较全面准确的结果。</p>
</div>
<div class="paragraph">
<p>执行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">jmeter -n -t test-plan.jmx -q options.properties -l result.csv -e -o report</code></pre>
</div>
</div>
<div class="paragraph">
<p>测试报告：</p>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
