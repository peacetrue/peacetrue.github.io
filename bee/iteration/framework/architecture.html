<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>架构 :: 安宁的知识库</title>
    <link rel="canonical" href="https://peacetrue.github.io/bee/iteration/framework/architecture.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://peacetrue.github.io">安宁的知识库</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="bee" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">开发者助手</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../index.html">简介</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../developer.html">开发者手册</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../version.html">版本变更</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">基础框架</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="architecture.html">架构</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="frontend.html">前端项目</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="backend.html">后端项目</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="load.html">负载测试</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">数据转换</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../conversion/requirement.html">需求</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../conversion/function.html">功能</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../conversion/design.html">设计</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../conversion/api.html">接口</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">开发者助手</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../peacetrue-shell/index.html">Shell 脚本库</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../peacetrue-shell/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../peacetrue-common/index.html">公共组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../peacetrue-common/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../peacetrue-result/index.html">响应结果组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../peacetrue-result/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../learn-asciidoc/index.html">学习 AsciiDoc</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../learn-asciidoc/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../peacetrue-cryptography/index.html">密码学组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../peacetrue-cryptography/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../../index.html">开发者助手</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../overview/index.html">总览</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../overview/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../peacetrue-test/index.html">测试组件</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../peacetrue-test/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../peacetrue-beans/index.html">简单 Java 对象</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../peacetrue-beans/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">开发者助手</a></li>
    <li>基础框架</li>
    <li><a href="architecture.html">架构</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/peacetrue/bee/edit/master/docs/antora/modules/ROOT/pages/iteration/framework/architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">架构</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>使用 <a href="https://zhuanlan.zhihu.com/p/87855907" target="_blank" rel="noopener">前后端分离</a> 架构。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_项目划分"><a class="anchor" href="#_项目划分"></a>1. 项目划分</h2>
<div class="sectionbody">
<div class="imageblock plantuml">
<div class="content">
<img src="http://www.plantuml.com/plantuml/png/SoWkIImgAStDuOf-Eg7l-UhrJtRiVhfholCfAs8LR7HrxHIWmizdJtpMjnmgOwNmVFQE9xiclMoOzMJ_Gkmw5O0wEtk1md0zGF2qT-hJ2HEXsXnIyrA05WC0" alt="structure">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>前端应用：提供功能界面展示</p>
</li>
<li>
<p>后端主应用：提供功能接口</p>
</li>
<li>
<p>后端监控应用：监控后端主应用运行状态及异常告警</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">应用端口：</div>
<ul>
<li>
<p>前端应用：3000</p>
</li>
<li>
<p>后端监控应用：8081</p>
</li>
<li>
<p>后端主应用：8080</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_运行环境"><a class="anchor" href="#_运行环境"></a>2. 运行环境</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_开发"><a class="anchor" href="#_开发"></a>2.1. 开发</h3>
<div class="imageblock plantuml">
<div class="content">
<img src="http://www.plantuml.com/plantuml/png/SoWkIImgAStDuU82qfbfYSab2ayxUv-lNi_5bPQVav9QfF1qGX-GMysb00HmDKzsx7wwQyhpAIjGXP_FdlYiRpbKffQB2sAKWgwk7KA7bSAB3Sr0-bdVqgVzYz_lwSd9JqxCoSWl1jhSl_x5zXLFvy_dWgi6wqKsrahXsUOLJzjwa9JOwEgYANdHj_rf_pI8sBEUzcSBshaSKlDIWFu40000" alt="deployment-dev">
</div>
<div class="title">Figure 1. 开发运行模式</div>
</div>
<div class="ulist">
<div class="title">直接通过 IDE 运行，以 IntelliJ IDEA 为例：</div>
<ul>
<li>
<p>链接 Gradle 项目</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/manual/link-gradle.png" alt="link gradle"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>运行后端 <code>BeeMainApplication</code>：</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/manual/backend.png" alt="backend" width="50%"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>启动前端 <code>package.json</code>：</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/manual/frontend.png" alt="frontend" width="50%"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_本地"><a class="anchor" href="#_本地"></a>2.2. 本地</h3>
<div class="imageblock plantuml">
<div class="content">
<img src="http://www.plantuml.com/plantuml/png/NP5TQeD058NVPnMp0JSWfMG5tOCncWZg53k5GX4IAYObnXXg0sr8MoWbGafz2Fr1ctOppem-TGkrAjPatkQSS-Uxzqxh10i6FjLK82Bj6EcIZk5HLz7F092Hsf4CsCEQUWvWVYgXBKdbtGGcq16MO1jXZ3I8v2BCbm_0R7b3-mCw7oRn6rkyaEqrA0sEEwo2QHYJwRn6aSi9MuSxC1M9Whg7CvHk3__H2fE7zCuYSSJyUphosArLSjDNYqPUIGTvomMrAaYtONRrHTsddqyd-LvIPq0yAxi8oCXcusUs7jF-whyfpwsRobUbo8A8OV8HayXdVh0hiyMCkglACK5Zthg0XsGw8TuiYH-PPuDQBrBD-dokJK1ifn4vuBYzIEg-vmiiDUeCwSCGj2Iza__dBm00" alt="deployment-local">
</div>
<div class="title">Figure 2. 本地部署模式</div>
</div>
<div class="paragraph">
<p>添加 hosts 条目：</p>
</div>
<div class="listingblock">
<div class="title">/etc/hosts</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">echo '127.0.0.1 bee.peacetrue.local' &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nginx 配置：</p>
</div>
<div class="listingblock">
<div class="title">bee.peacetrue.local</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-conf hljs" data-lang="conf">server {
    listen       80;
    server_name  bee.peacetrue.local;

    root html/bee;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /monitor/ {
       proxy_pass http://localhost:8081/;
    }

    location /api/ {
       proxy_pass http://localhost:8080/;
    }

    location /swagger-ui/ {
       proxy_pass http://localhost:8080;
    }

    location /v3/api-docs/ {
       proxy_pass http://localhost:8080;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_生产"><a class="anchor" href="#_生产"></a>2.3. 生产</h3>
<div class="imageblock plantuml">
<div class="content">
<img src="http://www.plantuml.com/plantuml/png/SoWkIImgAStDuKhEpot8pqlDAr7mIy_Cg-3YIilFIKajKiWeoSsfvb800gX0KcegX5_BLSkLbr-Igf2KNrAIdwkGdmPMR0KnGE7bt9dF6XgVJMj_idlRyzdhdkwTYguQQ9ALmjFEtkUhrqCKlzZQycpN1AXYY2cwkdPGKr-it_sqVnhSNKydz07rGLm2z49cMc9oYSAJ7RkVxfhoVCeALE7dioS-wriEbQdbGZ8QhW7eaFxUfnCcFjcz-Fc4DYwuE5WLiduhXMURLpnjwq5IOgEhYwRaHTzse5iXOizwsfyjQEToICrB0OOp0000" alt="deployment-remote">
</div>
<div class="title">Figure 3. 远程部署模式</div>
</div>
<div class="paragraph">
<p>Nginx 配置：</p>
</div>
<div class="listingblock">
<div class="title">bee.peacetrue.cn</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-conf hljs" data-lang="conf">server {
    listen       80;
    server_name  bee.peacetrue.cn;

    root html/bee;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /monitor/ {
       proxy_pass http://localhost:8081/;
    }

    location /api/ {
       proxy_pass http://localhost:8080/;
    }

    location /swagger-ui/ {
       proxy_pass http://localhost:8080;
    }

    location /v3/api-docs/ {
       proxy_pass http://localhost:8080;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>本地打完包后，上传到服务器，完成上线部署。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_技术栈"><a class="anchor" href="#_技术栈"></a>3. 技术栈</h2>
<div class="sectionbody">
<div class="paragraph">
<p>此处仅描述核心技术，
其他技术根据实际需要在适当的时机引入。</p>
</div>
<div class="ulist">
<div class="title">前端</div>
<ul>
<li>
<p><a href="https://reactjs.org/" target="_blank" rel="noopener">React</a> 18+</p>
</li>
<li>
<p><a href="https://mui.com/" target="_blank" rel="noopener">MUI</a> 5+</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">后端</div>
<ul>
<li>
<p><a href="https://www.oracle.com/java">Java</a> 8+</p>
</li>
<li>
<p><a href="https://spring.io/projects/spring-boot/" target="_blank" rel="noopener">Spring Boot</a> 2+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_接口协议"><a class="anchor" href="#_接口协议"></a>4. 接口协议</h2>
<div class="sectionbody">
<div class="paragraph">
<p>后端接口基于 <a href="https://zh.wikipedia.org/zh-cn/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE">HTTP</a> 协议，
遵循 <a href="https://zh.wikipedia.org/zh-cn/%E8%A1%A8%E7%8E%B0%E5%B1%82%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2">REST API</a> 规范。</p>
</div>
<div class="sect2">
<h3 id="_接口版本规范"><a class="anchor" href="#_接口版本规范"></a>4.1. 接口版本规范</h3>
<div class="paragraph">
<p>使用响应 <a href="https://en.wikipedia.org/wiki/Media_type" target="_blank" rel="noopener">媒体类型</a> 定义接口版本，
格式为 <strong>application/vnd.bee.<em>version</em>+json</strong>。</p>
</div>
<div class="paragraph">
<p><em>version</em> 表示版本号，
例如：<strong>application/vnd.bee.v1+json</strong>、<strong>application/vnd.bee.v2+json</strong> 。</p>
</div>
<div class="paragraph">
<p>为什么不使用 URI 形式的版本？以及如何简单地在服务端和客户端升级版本？</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.baeldung.com/rest-versioning" class="bare">https://www.baeldung.com/rest-versioning</a></p>
</li>
<li>
<p><a href="https://www.baeldung.com/spring-rest-custom-media-type" class="bare">https://www.baeldung.com/spring-rest-custom-media-type</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_响应结果"><a class="anchor" href="#_响应结果"></a>4.2. 响应结果</h3>
<div class="paragraph">
<p>前端根据后端响应状态处理返回数据。
非 200 状态码，直接提示 <code>statusText</code> 值。</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
